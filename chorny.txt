#!/bin/bash

# ë¡œê·¸ íŒŒì¼ ìœ„ì¹˜
LOGFILE="/var/log/chrony_sync.log"

echo "===== Chrony ì‹œê°„ ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œì‘ =====" | tee -a "$LOGFILE"

# 1. Chrony ì„¤ì¹˜ (ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ê±´ë„ˆëœ€)
echo "ğŸ”„ Chrony ì„¤ì¹˜ í™•ì¸ ì¤‘..." | tee -a "$LOGFILE"
if ! rpm -q chrony &>/dev/null; then
    sudo dnf install -y chrony | tee -a "$LOGFILE"
else
    echo "âœ… Chronyê°€ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤." | tee -a "$LOGFILE"
fi

# 2. Chrony ì„œë¹„ìŠ¤ í™œì„±í™” ë° ì‹œì‘
echo "ğŸ”„ Chrony ì„œë¹„ìŠ¤ í™œì„±í™” ë° ì‹œì‘..." | tee -a "$LOGFILE"
sudo systemctl enable --now chronyd | tee -a "$LOGFILE"

# 3. ì¦‰ì‹œ ì‹œê°„ ë™ê¸°í™” ìˆ˜í–‰
echo "â³ ì‹œê°„ ë™ê¸°í™” ìˆ˜í–‰ ì¤‘..." | tee -a "$LOGFILE"
sudo chronyc tracking | tee -a "$LOGFILE"

# ê°•ì œ ì‹œê°„ ë™ê¸°í™” (ì„ íƒì )
echo "ğŸ”„ ê°•ì œ ì‹œê°„ ë™ê¸°í™” ìˆ˜í–‰..." | tee -a "$LOGFILE"
sudo chronyc makestep | tee -a "$LOGFILE"

# 4. ë™ê¸°í™” ìƒíƒœ í™•ì¸
echo "ğŸ” ë™ê¸°í™” ìƒíƒœ í™•ì¸..." | tee -a "$LOGFILE"
sudo chronyc sources -v | tee -a "$LOGFILE"

echo "ğŸ‰ ì‹œê°„ ë™ê¸°í™” ì™„ë£Œ!" | tee -a "$LOGFILE"
